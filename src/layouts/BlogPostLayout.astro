---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "$components/FormattedDate.astro";
import Comment from "$components/Comment.astro";
import { kEnableComment, kSiteTitle, kUrlBase } from "$consts";
import BaseLayout from "./BaseLayout.astro";
import TagList from "$components/TagList.astro";

interface IdExt {
  id: string;
}

type Props = CollectionEntry<"blog">["data"] & (IdExt | { id: false });

const { id, title, description, date, updatedDate, tags } = Astro.props;
---

<BaseLayout
  pageTitle={`${title} | ${kSiteTitle}`}
  pageDescription={description}
>
  <main class="container flex flex-col flex-1">
    <article class="w-full mx-auto flex-1">
      <div class="prose prose-lg max-w-none">
        <section class="mb-8" aria-label="Title">
          <div
            class="flex flex-col lg:flex-row sm:flex-wrap gap-2 text-sm opacity-70 mb-4"
          >
            {
              [
                date && (
                  <span>
                    <FormattedDate date={date} />
                    {updatedDate && (
                      <span class="ml-1">
                        , Last updated on{" "}
                        <FormattedDate date={updatedDate || date} />
                      </span>
                    )}
                  </span>
                ),
                id && (
                  <span>
                    <span id="vercount_value_page_pv" class="tabular-nums">
                      Loading...
                    </span>{" "}
                    views
                  </span>
                ),
                tags && tags.length > 0 && (
                  <TagList
                    tags={tags}
                    classes="badge badge-outline hover:text-blue-500 not-prose"
                  />
                ),
              ]
                .filter(Boolean)
                .map((element, index, array) => (
                  <>
                    {element}
                    {index < array.length - 1 && (
                      <span class="divider divider-horizontal mx-1 hidden lg:flex " />
                    )}
                  </>
                ))
            }
          </div>

          <h1 class="text-4xl font-bold mb-4">{title}</h1>
          <div class="divider"></div>
        </section>
        <slot />
      </div>
    </article>

    {
      id && kEnableComment && (
        <div class="w-full mx-auto mt-auto ">
          <Comment />
        </div>
      )
    }
  </main>
</BaseLayout>
