---
import { kUrlBase } from "$consts";
import { Icon } from "astro-icon/components";

const { page } = Astro.props;

function getPageNumbers(currentPage: number, lastPage: number) {
  const delta = 2;
  const range = [];
  const rangeWithDots = [];

  for (
    let i = Math.max(2, currentPage - delta);
    i <= Math.min(lastPage - 1, currentPage + delta);
    i++
  ) {
    range.push(i);
  }

  if (currentPage - delta > 2) {
    rangeWithDots.push(1, "...");
  } else {
    rangeWithDots.push(1);
  }

  rangeWithDots.push(...range);

  if (currentPage + delta < lastPage - 1) {
    rangeWithDots.push("...", lastPage);
  } else if (lastPage > 1) {
    rangeWithDots.push(lastPage);
  }

  return rangeWithDots;
}

const pageNumbers =
  page.lastPage > 1 ? getPageNumbers(page.currentPage, page.lastPage) : [];
---

{
  page.lastPage > 1 && (
    <div class="hidden sm:block">
      <div class="flex justify-center mt-8">
        <div class="join">
          {page.url.prev ? (
            <a href={page.url.prev} class="join-item btn btn-outline">
              <Icon name="ri:arrow-left-s-line" size="22" />
              上一页
            </a>
          ) : (
            <button class="join-item btn btn-outline btn-disabled">
              <Icon name="ri:arrow-left-s-line" size="22" />
              上一页
            </button>
          )}

          {pageNumbers.map((pageNum) =>
            pageNum === "..." ? (
              <button class="join-item btn btn-outline btn-disabled">
                ...
              </button>
            ) : pageNum === page.currentPage ? (
              <button class="join-item btn btn-active btn-outline">
                {pageNum}
              </button>
            ) : (
              <a
                href={
                  pageNum === 1
                    ? `${kUrlBase}/blog/`
                    : `${kUrlBase}/blog/${pageNum}/`
                }
                class="join-item btn btn-outline"
              >
                {pageNum}
              </a>
            )
          )}

          {page.url.next ? (
            <a href={page.url.next} class="join-item btn btn-outline">
              下一页
              <Icon name="ri:arrow-right-s-line" size="22" />
            </a>
          ) : (
            <button class="join-item btn btn-outline btn-disabled">
              下一页
              <Icon name="ri:arrow-right-s-line" size="22" />
            </button>
          )}
        </div>
      </div>
    </div>
  )
}

<div class="flex justify-between mt-4 sm:hidden">
  {
    page.url.prev ? (
      <a href={page.url.prev} class="btn btn-outline btn-sm">
        <Icon name="ri:arrow-left-s-line" size="16" />
        上一页
      </a>
    ) : (
      <button class="btn btn-outline btn-sm btn-disabled">← 上一页</button>
    )
  }

  <span class="flex items-center text-sm">
    {page.currentPage} / {page.lastPage}
  </span>

  {
    page.url.next ? (
      <a href={page.url.next} class="btn btn-outline btn-sm">
        下一页
        <Icon name="ri:arrow-right-s-line" size="16" />
      </a>
    ) : (
      <button class="btn btn-outline btn-sm btn-disabled">下一页 →</button>
    )
  }
</div>
