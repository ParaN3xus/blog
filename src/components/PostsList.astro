---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";

import {
  kSiteTitle,
  kSiteIndexTitle,
  kSiteDescription,
  kUrlBase,
} from "$consts";
import Profile from "$components/Profile.astro";
import TagList from "./TagList.astro";
// @ts-ignore
interface Props {
  posts?: any[];
  size?: number;
  offset?: number;
}

const { size = -1, offset = 0, posts = null } = Astro.props;
const allPosts =
  posts ||
  (await getCollection("blog")).sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
  );

const slicedPosts =
  size > 0 ? allPosts.slice(offset, offset + size) : allPosts.slice(offset);
---

<div class="space-y-4">
  {
    slicedPosts.map((post) => (
      <div class="border-b border-base-200 pb-4 last:border-b-0">
        <div class="flex flex-col gap-2">
          <h3 class="font-semibold text-lg hover:text-primary transition-colors">
            <a href={`${kUrlBase}/article/${post.id}/`} class="link-hover">
              {post.data.title}
            </a>
          </h3>

          {post.data.description && (
            <p class="text-base-content/70 text-sm">{post.data.description}</p>
          )}

          <div class="flex justify-between text-xs text-base-content/60 space-x-4">
            <time class="flex items-center gap-1">
              <Icon name="ri:calendar-line" size="20px" />
              {new Date(post.data.date).toLocaleDateString("zh-CN")}
            </time>

            {post.data.tags && post.data.tags.length > 0 && (
              <div class="flex items-center max-w-md overflow-x-auto scrollbar-hide">
                <div class="flex justify-end min-w-max">
                  <TagList
                    tags={post.data.tags}
                    classes="badge badge-outline badge-sm hover:text-blue-500"
                  />
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    ))
  }
</div>
